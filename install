#!/bin/sh

test -e database || mkdir database
test -e database/backup || mkdir database/backup
test -e database/envio || mkdir database/envio
test -e database/sig-upload-data || mkfifo database/sig-upload-data

echo "Installing chancelor..."

# fixed chancelor to local bin
mkdir -p "/usr/local/bin/"
sed 's;\(MYTEMPO_DATA=\);\1'"$(realpath .);" System/chancelor > "/usr/local/bin/chancelor"
chmod +x "/usr/local/bin/chancelor"

# linking the service
systemctl link ./System/systemd/system/chancelor.service

# grub configuration (USB autosuspend off)
echo "Disabling USB autosuspend (see #3)"

sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT="/&usbcore.autosuspend=-1 /' /etc/default/grub
update-grub

echo "All done! Please reboot your device for the changes to take place."
